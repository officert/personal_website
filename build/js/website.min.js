angular.module("app", [ "ngCookies", "ngResource", "ui.bootstrap", "ui.router", "ngStorage", "ngAnimate", "app" ]);

angular.module("app").controller("homeController", [ "$scope", function($scope) {
    "use strict";
    $scope.links = [ {
        title: "GitHub",
        url: "https://github.com/officert",
        icon: "fa-github"
    }, {
        title: "LinkedIn",
        url: "http://lnkd.in/jqpTXe",
        icon: "fa-linkedin"
    }, {
        title: "Twitter",
        url: "https://twitter.com/timothyOfficer",
        icon: "fa-twitter"
    } ];
} ]);

angular.module("app").config([ "$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider) {
    "use strict";
    $urlRouterProvider.otherwise("/404");
    $stateProvider.state("home", {
        url: "",
        templateUrl: "/js/views/home.html",
        controller: "homeController"
    }).state("system.404", {
        url: "404",
        templateUrl: "/js/views/404.html",
        controller: "errorController"
    });
} ]);

angular.module("app").factory("analytics", [ "$window", "$rootScope", "$location", function($window, $rootScope, $location) {
    "use strict";
    if (!$window.ga) throw new Error("Google Analytics not loaded!");
    function trackPageView(path) {
        console.log("track page : path=" + path);
        $window.ga("send", "pageview", path);
    }
    function trackEvent(eventCategory, eventAction, eventLabel) {
        console.log("track event : category=" + eventCategory + " : action=" + eventAction + " : label=" + eventLabel);
        $window.ga("send", "event", eventCategory, eventAction, eventLabel);
    }
    $rootScope.$on("$stateChangeSuccess", function() {
        trackPageView($location.path());
    });
    return {
        trackPageView: trackPageView,
        trackEvent: trackEvent
    };
} ]).run([ "analytics", function(analytics) {} ]);

angular.module("app").directive("analyticsOn", [ "analytics", function(analytics) {
    "use strict";
    return {
        restrict: "A",
        link: function($scope, $element, $attrs) {
            var eventAction = $attrs.analyticsOn;
            var eventCategory = $attrs.analyticsCategory;
            var eventLabel = $attrs.analyticsLabel;
            angular.element($element[0]).bind(eventAction, function($event) {
                analytics.trackEvent(eventCategory, eventAction, eventLabel);
            });
        }
    };
} ]);